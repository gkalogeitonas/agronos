services:
  # publish DB port so host processes (php artisan, etc.) can connect
  db:
    image: mysql:8
    ports:
      - "3306:3306"
    healthcheck:
      test: ["CMD", "mysqladmin", "ping", "-h", "127.0.0.1"]
      interval: 5s
      timeout: 2s
      retries: 12

  phpmyadmin:
    image: phpmyadmin/phpmyadmin:latest
    container_name: agronos_phpmyadmin
    restart: unless-stopped
    depends_on:
      - db
    environment:
      # connect to the published DB port on the Docker host so no custom network is required
      PMA_HOST: host.docker.internal
      PMA_PORT: 3306
      UPLOAD_LIMIT: 300M
    ports:
      - "8081:80"
    extra_hosts:
      # allow the container to resolve host.docker.internal to the host gateway
      - "host.docker.internal:host-gateway"
    # Use the default Compose network in local dev (no explicit network required)

